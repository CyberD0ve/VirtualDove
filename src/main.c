#include <stdlib.h>
#include "inc/struct.h"
#include "inc/VM.h"

#define PROGRAM_SIZE 100

// Multiply two number

unsigned char program[PROGRAM_SIZE] = {
    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x90, 0x90,     // mov eax, 0x00
    0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x90, 0x90,     // mov ebx, 0x00
    0x01, 0x02, 0x00, 0x00, 0x00, 0xFF, 0x90, 0x90,     // mov ecx, 0x00
    0x01, 0x03, 0x00, 0x00, 0x00, 0xFF, 0x90, 0x90,     // mov edx, 0x00
    0x03, 0x01, 0x03, 0x90, 0x90, 0x90, 0x90, 0x90,     // add ebx, edx
    0x07, 0x02, 0x00, 0x00, 0x00, 0x01, 0x90, 0x90,     // subr ecx, 0x01
    0x05, 0x02, 0x00, 0x90, 0x90, 0x90, 0x90, 0x90,     // cmp ecx, eax
    0x10, 0x00, 0x00, 0x00, 0x04, 0x90, 0x90, 0x90,     // jnz 0x0000004
    0x00,                                               // exit
};

int main(){
    VirtualMachine* VM = initVM(256); //Init VM with 265 bytes of RAM
    loadProgramInVM(VM, program, PROGRAM_SIZE); //Load program in RAM
    run(VM);                          //Run the VM
}